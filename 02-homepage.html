<!DOCTYPE html>
<html>
	<head>
		<title>Dev Challenge: Homepage</title>
		<meta charset="utf-8"/>
		<!-- JQuery -->
		<script src="http://code.jquery.com/jquery-3.5.1.min.js"></script>
		<!-- Google Charts -->
		<script src="https://www.gstatic.com/charts/loader.js" type="text/javascript"></script>
		<!-- CSS: Bootstrap & my stylesheet devchallenge-styles.css -->
		<link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous"/>
		<link rel="stylesheet" type="text/css" href="Assets/devchallenge-styles.css"/>
	</head>
	<body>
		<nav class="devNavbar">
			<a href="/logout" class="devNavButton" alt="Log out">LOG OUT</a>
		</nav>
		<!-- welcome message (text defined by JavaScipt) -->
		<h1 id="welcome" class="white text-center"></h1>
		<!-- app icons -->
		<div class="cards cardHolder">
			<!-- Weather -->
			<div class="card homepage-icon">
				<h5 class="card-header homepage-icon-header">
					Weather
				</h5>
				<div class="card-body black">
					<div class="text-center">
						<img id="weather-icon"/>
						<span><span id="weather-temp"></span>&deg;C</span>
					</div>	
					<p id="weather-city" class="text-center"></p>
				</div>
			</div>
			<!-- News -->
			<div class="card homepage-icon pointer">
				<h5 class="card-header homepage-icon-header icon-link">
					News
				</h5>
				<div class="card-body black" style="padding: 0.8em; margin: 0 auto;">
					<h6 class="text-center">Latest from NY Times</h6>
					<p id="homeNewsHeadline" class="homepage-body-text"></p>
				</div>
				<a href="/04-news" class="stretched-link"></a>
			</div>
			<!-- Sport -->
			<div class="card homepage-icon pointer">
				<h5 class="card-header homepage-icon-header icon-link">
					Sport
				</h5>
				<div class="card-body black" style="padding: 0.8em; margin: 0 auto;">
					<h6 id="homeSportHeader" class="text-center">Follow a Serie A team</h6>
					<p id="homeSportText" class="homepage-body-text"></p>
				</div>
				<a href="/05-sport" class="stretched-link"></a>
			</div>
			<!-- Photos -->
			<div class="card homepage-icon pointer">
				<h5 class="card-header homepage-icon-header icon-link">
					Photos
				</h5>
				<div class="card-body black">
				</div>
				<a href="/06-photos" class="stretched-link"></a>
			</div>
			<!-- Tasks -->
			<div class="card homepage-icon pointer">
				<h5 class="card-header homepage-icon-header icon-link">
					Tasks
				</h5>
				<div class="card-body black">
					<div id="homepageTasks" class="homepage-body-text"></div>
				</div>
				<a href="/07-tasks" class="stretched-link"></a>
			</div>
			<!-- Clothes -->
			<div class="card homepage-icon"">
				<h5 class="card-header homepage-icon-header">
					Clothes
				</h5>
				<div class="card-body" style="padding: 0;">
					<div id="clothesPiechart" class="centre-img" style="margin: 0 auto;"></div>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			// retrieve user object from server session data
			$.ajax({
				url: "/getUser",
				complete: function(data) {
					// set welcome message
					$("#welcome").html(`Good day, ${data.responseJSON.username}`);
					// set task display
					var tasksToDisplay = [];
					data.responseJSON.tasks.forEach(function(taskItem) {
						if (tasksToDisplay.length < 3 && taskItem.task.length != 0) {
							console.log(taskItem, taskItem.tick);
							if (taskItem.tick == true) {
								var symbol = "&#128505;" // tick in box
							} else {
								var symbol = "&#9744;" // empty box
							}
							tasksToDisplay.push(decodeHtml(symbol + "&#160;") + taskItem.task);
						}
					});
					if (tasksToDisplay.length == 0) {
						$("#homepageTasks").append($("<p></p>").text("No tasks set."));
					} else {
						tasksToDisplay.forEach(function(taskText) {
							$("#homepageTasks").append($("<p></p>").text(taskText));
						});
					}
				}
			});
			//function to decode html entities
			function decodeHtml(html) {
				var txt = document.createElement("textarea");
				txt.innerHTML = html;
				return txt.value;
			}
		</script>
		<script src="Code/js03-weather.js"></script>
		<script src="Code/js04-news.js"></script>
		<script src="Code/js05-sport.js"></script>
		<script src="Code/js08-clothes.js"></script>
	</body>
</html>	